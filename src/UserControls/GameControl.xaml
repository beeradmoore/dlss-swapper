<?xml version="1.0" encoding="utf-8"?>
<usercontrols:FakeContentDialog
    x:Class="DLSS_Swapper.UserControls.GameControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:usercontrols="using:DLSS_Swapper.UserControls"
    xmlns:converters="using:DLSS_Swapper.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ct_converters="using:CommunityToolkit.WinUI.Converters"
    xmlns:data="using:DLSS_Swapper.Data"
    mc:Ignorable="d"
    d:DataContext="{d:DesignInstance Type=usercontrols:GameControlModel, IsDesignTimeCreatable=True}"
    HorizontalAlignment="Stretch"
    VerticalAlignment="Stretch">

    <usercontrols:FakeContentDialog.Resources>

        <ct_converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" TrueValue="Visible" FalseValue="Collapsed"  />
        <ct_converters:BoolToObjectConverter x:Key="FavouriteTextConverter" TrueValue="Favourited" FalseValue="Click to favourite" />
        <ct_converters:BoolToObjectConverter x:Key="FavouriteGlyphConverter" TrueValue="&#xE735;" FalseValue="&#xE734;" />
        <ct_converters:EmptyObjectToObjectConverter x:Key="EmptyObjectToObjectConverter" NotEmptyValue="True" EmptyValue="False" />

        <converters:DLSSStateVisibilityConverter x:Key="IsDownloadingConverter" DesierdState="Downloading" />
        <converters:DLSSStateVisibilityConverter x:Key="IsDownloadedConverter" DesierdState="Downloaded" />
        <converters:DLSSStateVisibilityConverter x:Key="IsNotFoundConverter" DesierdState="NotFound" />
        <converters:DLSSStateVisibilityConverter x:Key="IsImportedConverter" DesierdState="Imported" />

        <ControlTemplate x:Key="LeftButtonsControlTemplate" TargetType="ContentControl">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Bottom" XYFocusKeyboardNavigation="Enabled" Padding="{ThemeResource ContentDialogPadding}" Background="{TemplateBinding Background}" Spacing="8">
                <Button ToolTipService.ToolTip="Notes" Command="{Binding EditNotesCommand}">
                    <Button.Content>
                        <FontIcon Style="{StaticResource SagoeFluentIconsFontIcon}" Glyph="&#xE70B;"/>
                    </Button.Content>
                </Button>

                <Button ToolTipService.ToolTip="History" Command="{Binding ViewHistoryCommand}">
                    <Button.Content>
                        <FontIcon Style="{StaticResource SagoeFluentIconsFontIcon}" Glyph="&#xE81C;"/>
                    </Button.Content>
                </Button>

                <Button Command="{Binding FavouriteCommand}" ToolTipService.ToolTip="{Binding  Game.IsFavourite, Converter={StaticResource FavouriteTextConverter}}">
                    <Button.Content>
                        <FontIcon Style="{StaticResource SagoeFluentIconsFontIcon}" Glyph="{Binding Game.IsFavourite, Converter={StaticResource FavouriteGlyphConverter}}"/>
                    </Button.Content>
                </Button>
            </StackPanel>
        </ControlTemplate>



        <ControlTemplate x:Key="RightButtonsControlTemplate" TargetType="ContentControl">

            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Bottom" XYFocusKeyboardNavigation="Enabled" Padding="{ThemeResource ContentDialogPadding}" Background="{TemplateBinding Background}" Spacing="8">
                <Button Content="Remove" Visibility="{Binding CanRemove, Converter={StaticResource BoolToVisibilityConverter}}" Command="{Binding RemoveCommand}" />
                <Button x:Name="CloseButton" IsTabStop="False" Content="Close" Style="{ThemeResource DefaultButtonStyle}" ElementSoundMode="FocusOnly" Command="{Binding CloseCommand}" KeyboardAcceleratorPlacementMode="Hidden">
                    <Button.KeyboardAccelerators>
                        <KeyboardAccelerator Key="Escape" Modifiers="None" />
                    </Button.KeyboardAccelerators>
                </Button>
            </StackPanel>
        </ControlTemplate>

        <DataTemplate x:Key="DLLRecordDataTemplate" x:DataType="data:DLLRecord">

            <Grid HorizontalAlignment="Stretch">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="{x:Bind FullName}" />

                <ProgressRing Grid.Column="1" Visibility="{x:Bind LocalRecord, Converter={StaticResource IsDownloadingConverter}}" ToolTipService.ToolTip="Downloading" Minimum="0" Maximum="100" IsIndeterminate="false" Value="{x:Bind LocalRecord.DownloadProgress}" HorizontalAlignment="Right" Width="20" Height="20"  />

                <FontIcon Style="{StaticResource SagoeFluentIconsFontIcon}" Grid.Column="1" Visibility="{x:Bind LocalRecord, Converter={StaticResource IsNotFoundConverter}}" ToolTipService.ToolTip="Requires download" HorizontalAlignment="Right" Glyph="&#xE896;" Width="20" Height="20" />

                <FontIcon Style="{StaticResource SagoeFluentIconsFontIcon}" Grid.Column="1" Visibility="{x:Bind LocalRecord, Converter={StaticResource IsImportedConverter}}" ToolTipService.ToolTip="Imported" HorizontalAlignment="Right" Glyph="&#xE7B8;" Width="20" Height="20" />

            </Grid>
        </DataTemplate>

    </usercontrols:FakeContentDialog.Resources>

    <usercontrols:FakeContentDialog.Content>
        <Grid Grid.Row="0" ColumnSpacing="20" HorizontalAlignment="Stretch">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Orientation="Vertical" Spacing="8">
                <Grid Width="200" Height="300" CornerRadius="8"  BorderThickness="1" ColumnSpacing="0" RowSpacing="0" Margin="0" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}">

                    <!-- Padding="{ThemeResource ContentDialogPadding}" -->

                    <!-- Weird, but allows image to strecth centered rather than left align -->
                    <Border BorderThickness="0" Width="200" Height="300">
                        <Border.Background>
                            <ImageBrush Stretch="UniformToFill">
                                <ImageBrush.ImageSource>
                                    <BitmapImage CreateOptions="IgnoreImageCache" UriSource="{x:Bind ViewModel.Game.CoverImage, Mode=OneWay}"/>
                                </ImageBrush.ImageSource>
                            </ImageBrush>
                        </Border.Background>
                    </Border>

                    <Button HorizontalAlignment="Stretch" Background="Transparent" VerticalAlignment="Stretch" Command="{x:Bind ViewModel.AddCoverImageCommand}" AllowDrop="True" DragEnter="CoverButton_DragEnter" DragOver="CoverButton_DragOver" Drop="CoverButton_Drop" />
                </Grid>
            </StackPanel>

            <Grid Grid.Column="1" >

                <StackPanel Orientation="Vertical" HorizontalAlignment="Stretch" Spacing="4">
                    <TextBlock Text="Name" FontWeight="Bold" />
                    <TextBox Text="{x:Bind ViewModel.Game.Title}" IsReadOnly="True" />

                    <TextBlock Text="Install path" FontWeight="Bold" Padding="0,8,0,0" />
                    <Grid HorizontalAlignment="Stretch" ColumnSpacing="8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <TextBox  Grid.Column="0" IsReadOnly="True" Text="{x:Bind ViewModel.Game.InstallPath}" VerticalAlignment="Center" />

                        <Button Grid.Column="1" ToolTipService.ToolTip="Open folder" VerticalAlignment="Center" Command="{x:Bind ViewModel.OpenInstallPathCommand}">
                            <Button.Content>
                                <FontIcon Style="{StaticResource SagoeFluentIconsFontIcon}" Glyph="&#xE8A7;"/>
                            </Button.Content>
                        </Button>
                    </Grid>
                    
                    <Grid HorizontalAlignment="Stretch" ColumnSpacing="16" RowSpacing="4" Padding="0,8,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="0" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Column="0" Grid.Row="0" Text="DLSS" FontWeight="Bold" />
                        <!-- <TextBox Grid.Column="0" Grid.Row="1" HorizontalAlignment="Stretch" Text="{x:Bind ViewModel.Game.CurrentDLSS.Version}" IsReadOnly="True"></TextBox> -->
                        <!--<usercontrols:DLLPickerComboBox Grid.Column="0" Grid.Row="1" Game="{x:Bind ViewModel.Game}" GameAssetType="{x:Bind data:GameAssetType.DLSS}" SelectionChangedCommand="{x:Bind ViewModel.DLLChangedCommand}" />-->
                        <ComboBox 
                            Grid.Column="0"
                            Grid.Row="1"
                            ItemsSource="{x:Bind ViewModel.DLSSRecords}"
                            IsEnabled="{x:Bind ViewModel.IsDLSSAvailable}"
                            SelectedItem="{x:Bind ViewModel.CurrentDLSS}"
                            PlaceholderText="{x:Bind ViewModel.Game.CurrentDLSS.Version, FallbackValue='Not found'}"
                            ItemTemplate="{StaticResource DLLRecordDataTemplate}"
                            HorizontalAlignment="Stretch" />

                        <TextBlock Grid.Column="1" Grid.Row="0" Text="DLSS Frame Generation" FontWeight="Bold" />
                        <!-- <TextBox Grid.Column="1" Grid.Row="1" HorizontalAlignment="Stretch" Text="{x:Bind ViewModel.Game.CurrentDLSS_FG.Version}" IsReadOnly="True"></TextBox> -->
                        <!-- <usercontrols:DLLPickerComboBox Grid.Column="1" Grid.Row="1" Game="{x:Bind ViewModel.Game}" GameAssetType="{x:Bind data:GameAssetType.DLSS_G}" /> -->
                        <ComboBox 
                            Grid.Column="1"
                            Grid.Row="1"
                            ItemsSource="{x:Bind ViewModel.DLSSGRecords}"
                            IsEnabled="{x:Bind ViewModel.IsDLSSGAvailable}"
                            SelectedItem="{x:Bind ViewModel.CurrentDLSSG}"
                            PlaceholderText="{x:Bind ViewModel.Game.CurrentDLSS_FG.Version, FallbackValue='Not found'}"
                            ItemTemplate="{StaticResource DLLRecordDataTemplate}"
                            HorizontalAlignment="Stretch" />
                        
                        <TextBlock Grid.Column="0" Grid.Row="3" Text="DLSS Ray Reconstruction" FontWeight="Bold" />
                        <!-- <TextBox Grid.Column="0" Grid.Row="4" HorizontalAlignment="Stretch" Text="{x:Bind ViewModel.Game.CurrentDLSS_RR.Version}" IsReadOnly="True"></TextBox> -->
                        <!-- <usercontrols:DLLPickerComboBox Grid.Column="0" Grid.Row="4" Game="{x:Bind ViewModel.Game}" GameAssetType="{x:Bind data:GameAssetType.DLSS_D}" /> -->
                        <ComboBox 
                            Grid.Column="0"
                            Grid.Row="4"
                            ItemsSource="{x:Bind ViewModel.DLSSDRecords}"
                            IsEnabled="{x:Bind ViewModel.IsDLSSDAvailable}"
                            SelectedItem="{x:Bind ViewModel.CurrentDLSSD}"
                            PlaceholderText="{x:Bind ViewModel.Game.CurrentDLSS_RR.Version, FallbackValue='Not found'}"
                            ItemTemplate="{StaticResource DLLRecordDataTemplate}"
                            HorizontalAlignment="Stretch" />
                    </Grid>


                    <Grid HorizontalAlignment="Stretch" ColumnSpacing="16" RowSpacing="4" Padding="0,20,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Column="0" Grid.Row="0" Text="FSR 3.1 (DirectX 12)" FontWeight="Bold" />
                        <!--<TextBox Grid.Column="0" Grid.Row="1" HorizontalAlignment="Stretch" Text="{x:Bind ViewModel.Game.CurrentFSR_31_DX12.Version, FallbackValue='Not found'}" IsReadOnly="True"></TextBox> -->
                        <!-- <usercontrols:DLLPickerComboBox Grid.Column="0" Grid.Row="1" Game="{x:Bind ViewModel.Game}" GameAssetType="{x:Bind data:GameAssetType.FSR_31_DX12}" /> -->
                        <ComboBox 
                            Grid.Column="0"
                            Grid.Row="1"
                            ItemsSource="{x:Bind ViewModel.FSR31DX12Records}"
                            IsEnabled="{x:Bind ViewModel.IsFSR31DX12Available}"
                            SelectedItem="{x:Bind ViewModel.CurrentFSR31DX12}"
                            PlaceholderText="{x:Bind ViewModel.Game.CurrentFSR_31_DX12.Version, FallbackValue='Not found'}"
                            ItemTemplate="{StaticResource DLLRecordDataTemplate}"
                            HorizontalAlignment="Stretch" />

                        <TextBlock Grid.Column="1" Grid.Row="0" Text="FSR 3.1 (Vulkan)" FontWeight="Bold" />
                        <!-- <TextBox Grid.Column="1" Grid.Row="1" HorizontalAlignment="Stretch" Text="{x:Bind ViewModel.Game.CurrentFSR_31_VK.Version, FallbackValue='Not found'}" IsReadOnly="True"></TextBox> -->
                        <!-- <usercontrols:DLLPickerComboBox Grid.Column="1" Grid.Row="1" Game="{x:Bind ViewModel.Game}" GameAssetType="{x:Bind data:GameAssetType.FSR_31_VK}" /> -->
                        <ComboBox 
                            Grid.Column="1"
                            Grid.Row="1"
                            ItemsSource="{x:Bind ViewModel.FSR31VKRecords}"
                            IsEnabled="{x:Bind ViewModel.IsFSR31VKAvailable}"
                            SelectedItem="{x:Bind ViewModel.CurrentFSR31VK}"
                            PlaceholderText="{x:Bind ViewModel.Game.CurrentFSR_31_VK.Version, FallbackValue='Not found'}"
                            ItemTemplate="{StaticResource DLLRecordDataTemplate}"
                            HorizontalAlignment="Stretch" />
                    </Grid>

                    
                    <Grid HorizontalAlignment="Stretch" ColumnSpacing="16" RowSpacing="4" Padding="0,20,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="0" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Column="0" Grid.Row="0" Text="XeSS" FontWeight="Bold" />
                        <!-- <TextBox Grid.Column="0" Grid.Row="1" HorizontalAlignment="Stretch" Text="{x:Bind ViewModel.Game.CurrentXeSS.Version}" IsReadOnly="True"></TextBox> -->
                        <!-- <usercontrols:DLLPickerComboBox Grid.Column="0" Grid.Row="1" Game="{x:Bind ViewModel.Game}" GameAssetType="{x:Bind data:GameAssetType.XeSS}" /> -->
                        <ComboBox 
                            Grid.Column="0"
                            Grid.Row="1"
                            ItemsSource="{x:Bind ViewModel.XeSSRecords}"
                            IsEnabled="{x:Bind ViewModel.IsXeSSAvailable}"
                            SelectedItem="{x:Bind ViewModel.CurrentXeSS}"
                            PlaceholderText="{x:Bind ViewModel.Game.CurrentXeSS.Version, FallbackValue='Not found'}"
                            ItemTemplate="{StaticResource DLLRecordDataTemplate}"
                            HorizontalAlignment="Stretch" />

                        <TextBlock Grid.Column="1" Grid.Row="0" Text="XeSS Frame Generation" FontWeight="Bold" />
                        <!-- <TextBox Grid.Column="0" Grid.Row="1" HorizontalAlignment="Stretch" Text="{x:Bind ViewModel.Game.CurrentXeSS.Version}" IsReadOnly="True"></TextBox> -->
                        <!-- <usercontrols:DLLPickerComboBox Grid.Column="0" Grid.Row="1" Game="{x:Bind ViewModel.Game}" GameAssetType="{x:Bind data:GameAssetType.XeSS}" /> -->
                        <ComboBox 
                            Grid.Column="1"
                            Grid.Row="1"
                            ItemsSource="{x:Bind ViewModel.XeSSFGRecords}"
                            IsEnabled="{x:Bind ViewModel.IsXeSSFGAvailable}"
                            SelectedItem="{x:Bind ViewModel.CurrentXeSSFG}"
                            PlaceholderText="{x:Bind ViewModel.Game.CurrentXeSS_FG.Version, FallbackValue='Not found'}"
                            ItemTemplate="{StaticResource DLLRecordDataTemplate}"
                            HorizontalAlignment="Stretch" />


                        <TextBlock Grid.Column="0" Grid.Row="3" Text="XeLL" FontWeight="Bold" />
                        <!-- <TextBox Grid.Column="0" Grid.Row="1" HorizontalAlignment="Stretch" Text="{x:Bind ViewModel.Game.CurrentXeSS.Version}" IsReadOnly="True"></TextBox> -->
                        <!-- <usercontrols:DLLPickerComboBox Grid.Column="0" Grid.Row="1" Game="{x:Bind ViewModel.Game}" GameAssetType="{x:Bind data:GameAssetType.XeSS}" /> -->
                        <ComboBox 
                            Grid.Column="0"
                            Grid.Row="4"
                            ItemsSource="{x:Bind ViewModel.XeLLRecords}"
                            IsEnabled="{x:Bind ViewModel.IsXeLLAvailable}"
                            SelectedItem="{x:Bind ViewModel.CurrentXeLL}"
                            PlaceholderText="{x:Bind ViewModel.Game.CurrentXeLL.Version, FallbackValue='Not found'}"
                            ItemTemplate="{StaticResource DLLRecordDataTemplate}"
                            HorizontalAlignment="Stretch" />
                    </Grid>





                    <!--
                            <TextBlock Text="DLSS detected" FontWeight="Bold" Padding="0,20,0,0" />
                            <TextBlock Text="{Binding DLSSDetectedText}" />
                            -->
                </StackPanel>
            </Grid>



        </Grid>



    </usercontrols:FakeContentDialog.Content>
</usercontrols:FakeContentDialog>
